{"ast":null,"code":"import React,{useReducer,createContext}from\"react\";import AuthReducer from\"./authReducer\";import axios from\"axios\";import setAuthToken from\"./setAuthToken\";import AuthContext from\"./authContext\";const AuthState=props=>{const initialState={isAuthenticated:false,user:null,loading:false,errors:[],current:0,verified:false,displayVerified:false};const[state,dispatch]=useReducer(AuthReducer,initialState);// تحميل بيانات المستخدم فقط إذا تم التفعيل\nconst userLoaded=async()=>{if(localStorage.token)setAuthToken(localStorage.token);try{const config={headers:{\"Content-Type\":\"application/json\"}};const res=await axios.get(\"http://localhost:5000/api/user/current-user\",config);dispatch({type:\"USER_LOADED\",payload:res.data});}catch(err){dispatch({type:\"AUTH_ERROR\"});}};const register=async formData=>{const config={headers:{\"Content-Type\":\"application/json\"}};try{const res=await axios.post(\"http://localhost:5000/api/user/auth/register\",formData,config);localStorage.setItem(\"token\",res.data.token);dispatch({type:\"REGISTER_SUCCESS\",payload:res.data});// إذا الحساب مفعل\nif(res.data.user.verified){userLoaded();}else{dispatch({type:\"DISPLAY_VERIFY_EMAIL\"});}}catch(err){var _err$response;dispatch({type:\"REGISTER_FAIL\",payload:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data});}};const login=async formData=>{const config={headers:{\"Content-Type\":\"application/json\"}};try{const res=await axios.post(\"http://localhost:5000/api/user/auth/login\",formData,config);localStorage.setItem(\"token\",res.data.token);dispatch({type:\"LOGIN_SUCCESS\",payload:res.data});if(res.data.user.verified){userLoaded();}else{dispatch({type:\"DISPLAY_VERIFY_EMAIL\"});}}catch(err){var _err$response2;dispatch({type:\"LOGIN_FAIL\",payload:(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data});}};const logout=()=>{localStorage.removeItem(\"token\");setAuthToken(null);dispatch({type:\"LOGOUT\"});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{register,login,logout,userLoaded,isAuthenticated:state.isAuthenticated,user:state.user,loading:state.loading,errors:state.errors,current:state.current,verified:state.verified,displayVerified:state.displayVerified}},props.children);};export default AuthState;","map":{"version":3,"names":["React","useReducer","createContext","AuthReducer","axios","setAuthToken","AuthContext","AuthState","props","initialState","isAuthenticated","user","loading","errors","current","verified","displayVerified","state","dispatch","userLoaded","localStorage","token","config","headers","res","get","type","payload","data","err","register","formData","post","setItem","_err$response","response","login","_err$response2","logout","removeItem","createElement","Provider","value","children"],"sources":["C:/Users/ASUS/Desktop/Login/src/context/auth/authState.js"],"sourcesContent":["import React, { useReducer, createContext } from \"react\";\r\nimport AuthReducer from \"./authReducer\";\r\nimport axios from \"axios\";\r\nimport setAuthToken from \"./setAuthToken\";\r\nimport AuthContext from \"./authContext\";\r\n\r\n\r\nconst AuthState = (props) => {\r\n  const initialState = {\r\n    isAuthenticated: false,\r\n    user: null,\r\n    loading: false,\r\n    errors: [],\r\n    current: 0,\r\n    verified: false,\r\n    displayVerified: false,\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n\r\n  // تحميل بيانات المستخدم فقط إذا تم التفعيل\r\n  const userLoaded = async () => {\r\n    if (localStorage.token) setAuthToken(localStorage.token);\r\n    try {\r\n      const config = { headers: { \"Content-Type\": \"application/json\" } };\r\n      const res = await axios.get(\"http://localhost:5000/api/user/current-user\", config);\r\n      dispatch({ type: \"USER_LOADED\", payload: res.data });\r\n    } catch (err) {\r\n      dispatch({ type: \"AUTH_ERROR\" });\r\n    }\r\n  };\r\n\r\n  const register = async (formData) => {\r\n    const config = { headers: { \"Content-Type\": \"application/json\" } };\r\n    try {\r\n      const res = await axios.post(\r\n        \"http://localhost:5000/api/user/auth/register\",\r\n        formData,\r\n        config\r\n      );\r\n\r\n      localStorage.setItem(\"token\", res.data.token);\r\n      dispatch({ type: \"REGISTER_SUCCESS\", payload: res.data });\r\n\r\n      // إذا الحساب مفعل\r\n      if (res.data.user.verified) {\r\n        userLoaded();\r\n      } else {\r\n        dispatch({ type: \"DISPLAY_VERIFY_EMAIL\" });\r\n      }\r\n\r\n    } catch (err) {\r\n      dispatch({ type: \"REGISTER_FAIL\", payload: err.response?.data });\r\n    }\r\n  };\r\n\r\n  const login = async (formData) => {\r\n    const config = { headers: { \"Content-Type\": \"application/json\" } };\r\n    try {\r\n      const res = await axios.post(\r\n        \"http://localhost:5000/api/user/auth/login\",\r\n        formData,\r\n        config\r\n      );\r\n\r\n      localStorage.setItem(\"token\", res.data.token);\r\n      dispatch({ type: \"LOGIN_SUCCESS\", payload: res.data });\r\n\r\n      if (res.data.user.verified) {\r\n        userLoaded();\r\n      } else {\r\n        dispatch({ type: \"DISPLAY_VERIFY_EMAIL\" });\r\n      }\r\n\r\n    } catch (err) {\r\n      dispatch({ type: \"LOGIN_FAIL\", payload: err.response?.data });\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    setAuthToken(null);\r\n    dispatch({ type: \"LOGOUT\" });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        register,\r\n        login,\r\n        logout,\r\n        userLoaded,\r\n        isAuthenticated: state.isAuthenticated,\r\n        user: state.user,\r\n        loading: state.loading,\r\n        errors: state.errors,\r\n        current: state.current,\r\n        verified: state.verified,\r\n        displayVerified: state.displayVerified,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthState;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}